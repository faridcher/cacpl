<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Farid Cheraghi" />

<meta name="date" content="2023-10-28" />

<title>Hidden Markov Model</title>

<script src="main_files/header-attrs-2.25/header-attrs.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="/usr/lib/R/site-library/rmarkdown/rmarkdown/templates/html_vignette/resources/vignette.css" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Hidden Markov Model</h1>
<h3 class="subtitle">Cheetah 1 Movement Behavior Estimation</h3>
<h4 class="author">Farid Cheraghi</h4>
<h4 class="date">2023-10-28</h4>


<div id="TOC">
<ul>
<li><a href="#intro"><span class="toc-section-number">1</span>
Intro</a></li>
<li><a href="#movement-metrics"><span
class="toc-section-number">2</span> Movement metrics</a></li>
<li><a href="#model-fitting"><span class="toc-section-number">3</span>
Model fitting</a>
<ul>
<li><a href="#initial-parameters"><span
class="toc-section-number">3.1</span> Initial parameters</a></li>
<li><a href="#additional-terms"><span
class="toc-section-number">3.2</span> Additional terms</a></li>
<li><a href="#forward-step-wise-selection"><span
class="toc-section-number">3.3</span> Forward step-wise
selection</a></li>
<li><a href="#result"><span class="toc-section-number">3.4</span>
Result</a></li>
<li><a href="#goodness-of-fit"><span
class="toc-section-number">3.5</span> Goodness of fit</a></li>
<li><a href="#coeficient-95-confidence-intervals"><span
class="toc-section-number">3.6</span> Coeficient 95% Confidence
Intervals</a></li>
</ul></li>
<li><a href="#best-model"><span class="toc-section-number">4</span> Best
model</a>
<ul>
<li><a href="#model-plot"><span class="toc-section-number">4.1</span>
Model plot</a></li>
<li><a href="#states-plot"><span class="toc-section-number">4.2</span>
States plot</a></li>
</ul></li>
<li><a href="#reference">Reference</a></li>
</ul>
</div>

<div id="intro" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Intro</h1>
<p>We have used the hidden Markov chain to estimate the probability of
the animal being in each state. Hidden Markov chain is also helpful when
we include covariates. Incorporating covariates, if there is any
correlation with the movement metrics (step-length and turn-angle),
improves the model fitting and behavioral estimation; it also provides
us with the transitional probability matrices per covariate.</p>
</div>
<div id="movement-metrics" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Movement metrics</h1>
<p>In the top row of the following figure, time series of step-length
and turn-angle are shown. The step-length are in km and they have been
divided by <em>8h</em>, the time-interval of GPS observations, this the
step-lengths also exhibit <em>speed</em> time series. In the bottom row,
histograms are being shown; they follow their natural distribution and
the step-length could be fitted a Gamma and the turn-angle could be
fitted a Von-Mises distribution.</p>
</div>
<div id="model-fitting" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Model fitting</h1>
<p>Wind direction is the only circular covariate in the list of our
covariates. Circular statistics generally don’t have magnitude,
i.e. wind direction of 350 degree, is not much different from wind
direction of 10 degree. In order to introduce magnitude to wind
direction, we have used cosine of wind direction instead. Cosine or
Sine, take the periodicity of the statistics into account and therefore
<code>cos(350)</code> is very close to <code>cos(10)</code>. However the
cosine of 90 degree is not different from cosine 270, thus we have also
computed the sine of the wind direction and added it as covariate.</p>
<p>Wind direction is reported by meteorological organizations by the
direction from which it originates. For example, a northerly wind blows
from the north to the south. Wind direction is usually reported in
cardinal directions or in azimuth degrees. For example, a wind coming
from the south is given as 180 degrees; one from the east is 90
degrees.</p>
<p>For other covariates we have included only the covariate itself and
avoided to compute additional covariates such as second order
polynomials or logarithm. The reason is that the fitting of HMM models
doesn’t converge when we include these additional covariates.</p>
<div id="initial-parameters" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Initial
parameters</h2>
<p>The choice of initial values is very critical for the HMM model to
converge; it is important that the initial values to be as close as
possible to their actual (estimated) values. There are many density
functions that could characterize the distribution of movement metrics
including gamma, weibell, exponential and chi-square for step-length and
von-mises and wrapped-cauchy for the turn-angle distribution. gamma is
the most general distribution and other distribution such as exponential
or chi-square are the special cases for gamma. von-mises is the circular
version of normal distribution and perfectly characterizes the
turn-angle distribution. In the best case scenario of 2 states model,
where movement metrics exhibit huge contrast, the per state densities
are shown in the following illustration. In this graph, state 1 is the
resting mode also known as range-resident mode and the state 2 is the
moving mode (transient mode). In the resting mode the animal has shorter
step-lengths which are accumulated near zero and turn-angles have
roughly uniform distribution and their mean is zero. In the moving mode,
the animal has larger step-lengths and thus gamma density has a larger
mean and the density is skewed to the right to accommodate larger
step-lengths; turn-angles have mean zero and a large concentration
(small variance) that shows the directional movement in this mode.</p>
<p>In the rest of this document, state 1 and resting state, state 2 and
moving state are used interchangeably.</p>
<div class="figure">
<img src="movehmm1.png" alt="" />
<p class="caption">step-length and turn-angle distribution in high
contrast situation</p>
</div>
<div id="step-length" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Step-length</h3>
<p>The mean-variance parameterization is being used for gamma instead of
more common shape-rate parameterization as it is more intuitive to
reason about and relate to the step-length. A good practice to choose
the initial mean and variance for the gamma distribution is to plot the
step-length histogram and then overlay the density of gamma distribution
using various mean and variance values to make it as close as possible
to the gamma density shown in the above image. With the case of cheetah
step-length, after a few trial and error, I found the following values
as the best initial values for step-length gamma distribution:</p>
<table>
<caption>Initial values chosen for gamma distribution of cheetah
step-length</caption>
<thead>
<tr class="header">
<th align="center"></th>
<th align="center">Mean</th>
<th align="center">Standard deviation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">State 1</td>
<td align="center">0.1</td>
<td align="center">0.1</td>
</tr>
<tr class="even">
<td align="center">State 2</td>
<td align="center">0.5</td>
<td align="center">0.3</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># invisible(futils::par_fav())</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># load ch1 windspeed hmm model</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&#39;main.rda&#39;</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;helpers.r&#39;</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  ch1_hmm_windspeed<span class="sc">$</span>data<span class="sc">$</span>step,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">freq =</span> F,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">&quot;gray&quot;</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&#39;Step-length (Km)&#39;</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">12</span>),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#ylim= c(0,1),</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(moveHMM<span class="sc">:::</span><span class="fu">dgamma_rcpp</span>(x,.<span class="dv">1</span>,.<span class="dv">1</span>),<span class="dv">0</span>,<span class="dv">20</span>,<span class="at">col=</span><span class="dv">1</span>,<span class="at">add=</span>T,<span class="at">lwd=</span><span class="dv">2</span>) <span class="co">#state 1</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(moveHMM<span class="sc">:::</span><span class="fu">dgamma_rcpp</span>(x,.<span class="dv">5</span>,.<span class="dv">3</span>),<span class="dv">0</span>,<span class="dv">20</span>,<span class="at">col=</span><span class="dv">2</span>,<span class="at">add=</span>T,<span class="at">lwd=</span><span class="dv">2</span>) <span class="co">#state 2</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>,<span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;State 1&quot;</span>,<span class="st">&quot;State 2&quot;</span>),<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure">
<img src="main_files/figure-html/initvalue-1.png" alt="" />
<p class="caption">Superimposition of gamma density function on
step-length histogram with various mean and standard deviation values to
choose initial values</p>
</div>
<p>It is also better to introduce variation to the initial values. Due
to the numerical instability, in the model selection procedure, one
fixed initial value may not work and the model fitting won’t converge.
We have introduced random variation using normal distribution with a
relatively small variance (0.1) to the initial values to overcome this
situation.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mu0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,.<span class="dv">1</span>,<span class="at">sd=</span>.<span class="dv">1</span>),<span class="fu">rnorm</span>(<span class="dv">1</span>,.<span class="dv">5</span>,<span class="at">sd =</span> .<span class="dv">1</span>))    <span class="co">#initial mu of State 1, State 2</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sigma0 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,.<span class="dv">1</span>, <span class="at">sd=</span>.<span class="dv">1</span>),<span class="fu">rnorm</span>(<span class="dv">1</span>,.<span class="dv">3</span>, <span class="at">sd=</span>.<span class="dv">1</span>)) <span class="co">#initial sigma of State 1, State 2</span></span></code></pre></div>
<p>If some steps are exactly equal to zero, then strictly positive
distributions such as the gamma are inadequate. In such cases,
zero-inflated distributions can be considered. A zero-inflated step
length distribution simply assumes that there is a probability z of
observing a 0 and a probability of (1−z) of observing a positive value
distributed according to a standard positive distribution (e.g. a
gamma). In that case the (state-dependent) values z will be estimated,
with the remaining positive distribution, weighted by (1−z), specified
as one of the available standard step length distributions <span
class="citation">(<a href="#ref-patterson09"
role="doc-biblioref">Patterson et al. 2009</a>; <a
href="#ref-langrock12" role="doc-biblioref">Langrock et al.
2012</a>)</span>. We have excluded the zero-step length before model
fitting and therefore set the <em>zero mass</em> equal to 0.</p>
</div>
<div id="turn-angle" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Turn-angle</h3>
<p>Model fitting convergence is not very much sensitive to the
turn-angle initial values compared to step-length. Turn-angle means are
set to zero and kept fixed for both states and only concentration (<span
class="math inline">\(\kappa\)</span>) parameter of Von Mises is being
estimated where the initial values are set to 1 for moving state and set
to a value near zero (0.1) for resting state.</p>
<div class="figure">
<img src="von-mises.png" style="width:50.0%" alt="" />
<p class="caption">Von-mises distribution for various concentration
values</p>
</div>
</div>
</div>
<div id="additional-terms" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Additional terms</h2>
<p>We have computed additional terms to undertake a thorough model
selection procedure. Individual covariates (12) along with their square
root , logarithm, cosine of angle variables (“wind direction”) and 2nd
order polynomials are added as additional covariates. All possible
interactions of the main effects are also used in the model fitting
process. To avoid further complexity, we have assumed the relation is
linear and additive. For example, we have models of this type:</p>
<p><span class="math display">\[{\beta _0} + {\beta _1}\cos
(wind\_direction) + {\beta _2}height + {\beta _3}heigh{t^2} + {\beta
_5}temperature . elevation\]</span></p>
<table style="width:100%;">
<caption>List of additional covariates computed from main
effects</caption>
<colgroup>
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
</colgroup>
<thead>
<tr class="header">
<th>Main Effects</th>
<th>Square Root</th>
<th>Logarithm</th>
<th>Angle Cosine</th>
<th>Polynomials</th>
<th>Interaction</th>
<th>Sum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>12</td>
<td>12</td>
<td>12</td>
<td>2</td>
<td>24</td>
<td>12</td>
<td>74</td>
</tr>
</tbody>
</table>
<p>So we have 74 covariates that we have to build our model on.
Definitely, the best automatic approach would be “best subset selection”
that takes every possible combination of covariates and compares the
models performance, i.e. using AIC values. However, for <span
class="math inline">\(n=74\)</span>, <span class="math inline">\(2^n =
1.9 \times {10^{22}}\)</span> models will be computed which is not
reasonable. Instead we have opted for the “forward step wise selection”
which will not find the best possible model, rather a parsimonious model
close to the best model. forward step wise selection procedure reduces
the number of models to be evaluated to about <span
class="math inline">\(n^2 = 5476\)</span>, which can be done using a
modern computer in a fair amount of time.</p>
</div>
<div id="forward-step-wise-selection" class="section level2"
number="3.3">
<h2><span class="header-section-number">3.3</span> Forward step-wise
selection</h2>
<p>We have implemented the “forward step wise selection” to select the
best set of covariates. The pseudo-code is as the following
algorithm:</p>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Forward step wise selection (FSWS) algorithm <span
class="citation">(<a href="#ref-james13" role="doc-biblioref">James et
al. 2013</a>)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1. Let <span class="math inline">\(M_0\)</span> denote
the null model, which contains no predictors.</td>
</tr>
<tr class="even">
<td align="left">2. For <span
class="math inline">\(k=0,...,p-1\)</span>:</td>
</tr>
<tr class="odd">
<td align="left">i) Consider all <span
class="math inline">\(p-k\)</span> models that augment the predictors in
<span class="math inline">\(M_k\)</span> with one additional
predictor.</td>
</tr>
<tr class="even">
<td align="left">ii) Choose the best among these <span
class="math inline">\(p-k\)</span> models, and call it <span
class="math inline">\(M_{k+1}\)</span>.</td>
</tr>
<tr class="odd">
<td align="left">Here best is defined as having highest likelihood (MLE)
value.</td>
</tr>
<tr class="even">
<td align="left">3. Select a single best model from among <span
class="math inline">\(M_0,...,M_p AIC\)</span>.</td>
</tr>
</tbody>
</table>
</div>
<div id="result" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Result</h2>
<p>The result of FSWS leads to a few models that outperform the null
model. The best model, in terms of AIC values, is the model with
<code>~wind_speed + city_dist</code> covariates. The <code>~1</code> is
the null model without any covariate in the following table. The third
column in this table is the agreement of the states estimated using
Viterbi algorithm against the null model states estimation.</p>
<table>
<caption>AIC values of models that outperform null model</caption>
<thead>
<tr class="header">
<th>Name</th>
<th>AIC</th>
<th>State-agreement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>~wind_speed+city_dist</td>
<td>980.56</td>
<td>0.93</td>
</tr>
<tr class="even">
<td>~wind_speed</td>
<td>981.41</td>
<td>0.97</td>
</tr>
<tr class="odd">
<td>~wind_speed+elevation+city_dist</td>
<td>981.79</td>
<td>0.92</td>
</tr>
<tr class="even">
<td>~wind_speed+elevation</td>
<td>982.89</td>
<td>0.97</td>
</tr>
<tr class="odd">
<td>~1</td>
<td>986.64</td>
<td>1.00</td>
</tr>
</tbody>
</table>
</div>
<div id="goodness-of-fit" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Goodness of fit</h2>
<p>Pseudo-residuals are suitable to check the goodness of fit for time
series model like hidden Markov chain. The pseudo-residuals (PR) of the
step-lengths and turn-angles could be computed from output of hidden
Markov model. On the other hand, Jarque-bera test statistics, tests the
null of normality for x (step-length and turn-angle). Running the test
on the PR of the best model (<code>~wind_speed + city_dist</code>),
shows that the PR of step-length violates the normality assumption
(p-value = 0.03662) within 95% confidence interval and thus is not a
good model. By choosing the next available model in terms of AIC and
computing the Jarque-bera statistics, we see the step-length p-value
(0.05093) is not significant within 95% confidence interval. So we
choose this simple model with only wind speed covariate as our best
model.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># jarque bera test for noramlity of step-length and turn-angle pseudo residuals</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ch1_hmm_windspeed <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>moveHMM<span class="sc">::</span><span class="fu">pseudoRes</span>() <span class="sc">%$%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">step =</span> tseries<span class="sc">::</span><span class="fu">jarque.bera.test</span>(stepRes[<span class="fu">complete.cases</span>(stepRes)]),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">angleRes =</span> tseries<span class="sc">::</span><span class="fu">jarque.bera.test</span>(angleRes[<span class="fu">complete.cases</span>(angleRes)])</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## $step
## 
##  Jarque Bera Test
## 
## data:  stepRes[complete.cases(stepRes)]
## X-squared = 5.8747, df = 2, p-value = 0.05301
## 
## 
## $angleRes
## 
##  Jarque Bera Test
## 
## data:  angleRes[complete.cases(angleRes)]
## X-squared = 1.4284, df = 2, p-value = 0.4896</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>moveHMM<span class="sc">::</span><span class="fu">plotPR</span>(ch1_hmm_windspeed)</span></code></pre></div>
<pre><code>## Computing pseudo-residuals... DONE</code></pre>
<div class="figure">
<img src="main_files/figure-html/plotpr-1.png" alt="" />
<p class="caption">Time series, qq-plots, and autocorrelation functions
of the pseudo-residuals of the 2-states model.</p>
</div>
</div>
<div id="coeficient-95-confidence-intervals" class="section level2"
number="3.6">
<h2><span class="header-section-number">3.6</span> Coeficient 95%
Confidence Intervals</h2>
<p>The 95% confidence interval of the coefficients shows that the effect
of wind speed is only significant in the transitions from state 1 to
state 2 or 1. The coefficients are estimated only for <strong>1 &gt;
2</strong> and <strong>2 &gt; 1</strong>. The coefficients for <strong>1
&gt; 1</strong> could be computed from the coefficients of <strong>1
&gt; 2</strong> and the coefficients for <strong>2 &gt; 2</strong> could
be computed from coefficients of <strong>2 &gt; 1</strong>. They follow
this simple formula:</p>
<p><span class="math display">\[\begin{array}{*{20}{c}}
{{P_{1 &gt; 1}} = 1 - {P_{1 &gt; 2}}}&amp;{,}&amp;{{P_{2 &gt; 2}} = 1 -
{P_{2 &gt; 1}}}
\end{array}\]</span></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hmm_plot_CI</span>(ch1_hmm_windspeed)</span></code></pre></div>
<div class="figure">
<img src="main_files/figure-html/plot_ci-1.png" alt="" />
<p class="caption">95% confidence interval of the coefficient estimes
shows that only the <code>wind_speed</code> is significant when
transitioning from state 1 to state 1 or 2</p>
</div>
<p>The wind speed only affects the probabilities from the resting state.
Animals that are resting are more likely to stay resting when the wind
is high, and likewise less likely to start moving when the wind is high.
However it is interesting that there is no significant (or even
suggestive) effect of wind speed on animals that are already moving.
That may speak to the pre-eminence of their motivation to be moving
(e.g. hunger, looking for food etc) despite conditions.</p>
</div>
</div>
<div id="best-model" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Best model</h1>
<p>The output of the model confirms that the initial parameters value
have been selected wisely due to their closeness to the estimated
values. The only regression coefficient for the transition probabilities
that is robust and could be interpreted is the wind speed for transition
from state 2 to state 1 or 2. The negative values implies that the
probability of switching from moving to resting state decreases as wind
speed increases. Likewise, the probability of staying in moving state
(2) increases as the wind speed increases.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ch1_hmm_windspeed)</span></code></pre></div>
<pre><code>## Value of the maximum log-likelihood: -477.7144 
## 
## Step length parameters:
## ----------------------
##         state 1   state 2
## mean 0.05961488 0.3859205
## sd   0.09799240 0.2971999
## 
## Turning angle parameters:
## ------------------------
##                    state 1   state 2
## mean          0.000000e+00 0.0000000
## concentration 1.397111e-08 0.9691988
## 
## Regression coeffs for the transition probabilities:
## --------------------------------------------------
##                1 -&gt; 2      2 -&gt; 1
## intercept  -0.4156253 -1.84277685
## wind_speed -1.2858882  0.05902679
## 
## Initial distribution:
## --------------------
## [1] 2.37909e-10 1.00000e+00</code></pre>
<div id="model-plot" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Model plot</h2>
<p>Histogram of step lengths with fitted distributions (top-left),
histogram of turning angles with fitted distributions (top-right),
transition probabilities as functions of wind_speed (bottom-left), and
map of decoded track for the cheetah (bottom-right) are shown below:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ch1_hmm_windspeed, <span class="at">ask=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Decoding states sequence... DONE</code></pre>
<p><img src="main_files/figure-html/plot_moveHMM-1.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-2.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-3.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-4.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-5.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-6.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-7.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-8.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-9.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-10.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-11.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-12.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-13.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-14.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-15.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-16.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-17.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-18.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-19.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-20.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-21.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-22.png" /><!-- --><img
src="main_files/figure-html/plot_moveHMM-23.png" /><!-- --></p>
</div>
<div id="states-plot" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> States plot</h2>
<p>In the following illustration the estimated probability of being in
each state is shown. The actual states (1,2) could be computed using two
approaches:</p>
<ol style="list-style-type: decimal">
<li><p>Viterbi: Reconstructs the most probable states sequence, using
the Viterbi algorithm <span class="citation">(<a href="#ref-zucchini09"
role="doc-biblioref">Zucchini and MacDonald 2009</a>)</span>. The result
of Viterbi is shown in the top row of the following
illustration.</p></li>
<li><p>Conditional statement: In this method, if the probability of
being in state 1 is more than a threshold i.e. 0.5, then the animal is
in state 1.</p></li>
</ol>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># states</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>moveHMM<span class="sc">::</span><span class="fu">plotStates</span>(ch1_hmm_windspeed, <span class="at">ask=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Decoding states sequence... DONE
## Computing states probabilities... DONE</code></pre>
<div class="figure">
<img src="main_files/figure-html/plotStates-1.png" alt="" />
<p class="caption">Decoded states sequence (top row), and state
probabilities of observations (middle and bottom rows)</p>
</div>
</div>
</div>
<div id="reference" class="section level1 unnumbered">
<h1 class="unnumbered">Reference</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-cheraghi17" class="csl-entry">
Cheraghi, Faridedin, Mahmoud Reza Delavar, Farshad Amiraslani, Kazem
Alavipanah, Eliezer Gurarie, and William F. Fagan. 2017.
<span>“Statistical Analysis of Asiatic Cheetah Movement and Its
Spatio-Temporal Drivers.”</span> <em>Journal of Arid Environments</em>.
</div>
<div id="ref-james13" class="csl-entry">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani.
2013. <em>An Introduction to Statistical Learning: With Applications in
r</em>. 1st ed. 2013, Corr. 6th printing 2016 edition. Springer.
</div>
<div id="ref-langrock12" class="csl-entry">
Langrock, Roland, Ruth King, Jason Matthiopoulos, Len Thomas, Daniel
Fortin, and Juan M. Morales. 2012. <span>“Flexible and Practical
Modeling of Animal Telemetry Data: Hidden Markov Models and
Extensions.”</span> <em>Ecology</em> 93 (11): 2336–42. <a
href="https://doi.org/10.1890/11-2241.1">https://doi.org/10.1890/11-2241.1</a>.
</div>
<div id="ref-patterson09" class="csl-entry">
Patterson, Toby A., Marinelle Basson, Mark V. Bravington, and John S.
Gunn. 2009. <span>“Classifying Movement Behaviour in Relation to
Environmental Conditions Using Hidden Markov Models.”</span> <em>Journal
of Animal Ecology</em> 78 (6): 1113–23. <a
href="https://doi.org/10.1111/j.1365-2656.2009.01583.x">https://doi.org/10.1111/j.1365-2656.2009.01583.x</a>.
</div>
<div id="ref-zucchini09" class="csl-entry">
Zucchini, Walter, and Iain L. MacDonald. 2009. <em>Hidden Markov Models
for Time Series: An Introduction Using r</em>. CRC Press.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
